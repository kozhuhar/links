<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Video test</title>

    <link href="./video/video-js.min.css" rel="stylesheet">
    <link href="./video/videojs.record.css" rel="stylesheet">
    <link href="./video/examples.css" rel="stylesheet">
    <script src="./video/video.min.js"></script>

    <script src="./video/RecordRTC.js"></script>
    <script src="./video/adapter.js"></script>

    <script src="./video/videojs.record.js"></script>

    <script src="./video/browser-workarounds.js"></script>

    <style>
        /* use background coloring to contrast the html element from the body element */
        html {
            height: 100%;
        }

        body {
            padding: 0;
            margin: 0;
            min-height: 100%;
        }

        body {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
        }

        #myVideo {
            background-color: #1a535c;
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body onload="onLoad()">

    <video id="myVideo" playsinline class="video-js vjs-default-skin"></video>

    <script>
        var player;

        function onLoad() {

            var width = window.screen.width;
            var height = window.screen.height;
            console.log("w = " + width + " h = " + height);

            /* eslint-disable */
            var options = {
                controls: true,
                width: width,
                height: height,
                fill: true,
                responsive: true,
                bigPlayButton: true,
                controlBar: {
                    volumePanel: false
                },
                plugins: {
                    record: {
                        audio: false,
                        video: true,
                        maxLength: 10,
                        displayMilliseconds: false,
                        debug: false
                    }
                }
            };

            // apply some workarounds for opera browser
            applyVideoWorkaround();

            player = videojs('myVideo', options, function () {
                // print version information at startup
                // var msg = 'Using video.js ' + videojs.VERSION +
                //     ' with videojs-record ' + videojs.getPluginVersion('record') +
                //     ' and recordrtc ' + RecordRTC.version;
                // videojs.log(msg);
            });

            // error handling
            player.on('deviceError', function () {
                console.warn('device error:', player.deviceErrorCode);
            });

            player.on('deviceReady', function () {
                player.fill(true);
                // console.log(player.record());
                // player.record().start();
            });

            player.on('error', function (element, error) {
                console.error(error);
            });

            // user clicked the record button and started recording
            player.on('startRecord', function () {
                console.log('started recording!');
            });

            // user completed recording and stream is available
            player.on('finishRecord', function () {
                // the blob object contains the recorded data that
                // can be downloaded by the user, stored on server etc.
                console.log('finished recording: ', player.recordedData);
            });

            player.record().getDevice();
        }
    </script>

</body>

</html>